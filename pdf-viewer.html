<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>PDF Viewer</title>
  <style>
    :root { color-scheme: light dark; }
    html,body { height:100%; margin:0; background:#0b1220; }
    body { display:flex; flex-direction:column; }
    header { padding:10px 14px; color:#fff; font:600 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    #viewer { flex:1; overflow:auto; display:flex; flex-direction:column; gap:24px; align-items:center; padding:16px; }
    canvas { box-shadow: 0 10px 30px rgba(0,0,0,.35); background:#fff; max-width: min(96vw, 1100px); height:auto; }
    .error { color:#fff; padding:40px; }
  </style>
</head>
<body>
  <header>문서를 불러오는 중…</header>
  <div id="viewer"></div>
  <script type="module">
    import { getDocument, GlobalWorkerOptions } from "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.5.136/pdf.min.mjs";
    GlobalWorkerOptions.workerSrc = "https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.5.136/pdf.worker.min.mjs";
    const qs = new URLSearchParams(location.search);
    const file = qs.get("file");
    const hdr = document.querySelector("header");
    const viewer = document.getElementById("viewer");
    if (!file) {
      hdr.textContent = "파일 주소가 없습니다.";
    } else {
      try {
        const task = getDocument(decodeURIComponent(file));
        const pdf = await task.promise;
        hdr.textContent = `페이지 ${pdf.numPages}개 문서`;
        const dpr = Math.min(window.devicePixelRatio || 1, 2);
        for (let p = 1; p <= pdf.numPages; p++) {
          const page = await pdf.getPage(p);
          const base = page.getViewport({ scale: 1 });
          const targetWidth = Math.min(window.innerWidth * 0.96, 1100);
          const scale = (targetWidth / base.width) * dpr;
          const viewport = page.getViewport({ scale });
          const canvas = document.createElement("canvas");
          const ctx = canvas.getContext("2d");
          canvas.width  = Math.floor(viewport.width);
          canvas.height = Math.floor(viewport.height);
          canvas.style.width  = Math.floor(viewport.width / dpr) + "px";
          canvas.style.height = Math.floor(viewport.height / dpr) + "px";
          viewer.appendChild(canvas);
          await page.render({ canvasContext: ctx, viewport }).promise;
        }
      } catch (e) {
        hdr.textContent = "문서를 표시할 수 없습니다.";
        const div = document.createElement("div");
        div.className = "error";
        div.textContent = e?.message || e || "알 수 없는 오류";
        viewer.appendChild(div);
      }
    }
  </script>
</body>
</html>